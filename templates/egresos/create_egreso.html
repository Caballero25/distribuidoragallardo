{% extends 'base/base_adminlte.html' %}
{% load static %}

{% block title %} Nuevo Egreso {% endblock %}

{% block extra_head %}
<!-- Estilos de jQuery UI -->
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="text-center">Nuevo Egreso</h1>
    <form method="POST">
        {% csrf_token %}
        <div class="form-group">
            <label for="fecha">Fecha</label>
            <input type="date" name="fecha" class="form-control" required>
        </div>

        <div class="form-group">
            <label for="tercero_nombre">Tercero</label>
            <input type="text" id="tercero_nombre" class="form-control" placeholder="Buscar tercero..." required>
            <input type="hidden" name="tercero" id="tercero_id"> <!-- Campo oculto para enviar el ID -->
        </div>

        <div class="form-group">
            <label for="valor">Valor</label>
            <input type="number" step="0.01" name="valor" class="form-control" required>
        </div>

        <div class="form-group">
            <label for="usuario">Usuario</label>
            <input type="text" name="usuario" class="form-control" required>
        </div>

        <div class="form-group">
            <label for="metodo_de_pago">Método de Pago</label>
            <select name="metodo_de_pago" class="form-control" required>
                <option value="EFECTIVO">Efectivo</option>
                <option value="TRANSFERENCIA">Transferencia</option>
            </select>
        </div>

        <div class="form-group">
            <label for="cuenta_por_pagar">Cuenta por Pagar</label>
            <input type="text" name="cuenta_por_pagar" class="form-control" required>
        </div>

        <button type="submit" class="btn btn-primary btn-block mt-4">Crear Egreso</button>
    </form>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<script>
    $(document).ready(function() {
        $("#tercero_nombre").autocomplete({
            source: function(request, response) {
                $.ajax({
                    url: "{% url 'get_tercero_by_name_din' %}",
                    dataType: "json",
                    data: {
                        term: request.term  // Parámetro de búsqueda
                    },
                    success: function(data) {
                        response($.map(data, function(item) {
                            return {
                                label: item.text,  // Nombre del tercero
                                value: item.text,  // Lo que se muestra en el input
                                id: item.id        // ID real del tercero
                            };
                        }));
                    }
                });
            },
            minLength: 2,  // Iniciar búsqueda después de 2 caracteres
            select: function(event, ui) {
                $("#tercero_id").val(ui.item.id);  // Guardar el ID en el campo oculto
            }
        });
    });
</script>
{% endblock %}
